# Notion API 클라이언트 테스트 가이드

이 가이드는 `src/client/notion_client.py`의 기능들을 테스트하는 방법을 설명합니다.

## 📋 사전 준비

### 1. 환경 변수 설정

`.env` 파일에 Notion API 키를 설정해야 합니다:

```bash
NOTION_API_KEY=your_notion_api_key_here
```

### 2. Notion API 키 발급

1. [Notion Developers](https://www.notion.so/my-integrations)에서 새 통합 생성
2. API 키 복사
3. 워크스페이스에 통합 추가

## 🚀 테스트 실행 방법

### 방법 1: 종합 테스트 (권장)

```bash
# 가상환경 활성화 (필수)
source venv/bin/activate  # 또는 conda activate your_env

# 종합 테스트 실행
python test_notion_client.py
```

**실행 시 입력 정보:**

- 검색할 페이지명 (예: "테스트", "메모" 등)
- 부모 페이지 ID (선택사항, 새 페이지 생성용)
- 데이터베이스 ID (선택사항, 데이터베이스 테스트용)

### 방법 2: 간단한 예제

```bash
# 가상환경 활성화
source venv/bin/activate

# 간단한 예제 실행
python example_notion_test.py
```

## 🧪 테스트 기능 목록

### 1. 페이지 검색 (`search_notion`)

- 페이지명으로 Notion 워크스페이스 검색
- 검색 결과에서 페이지 ID 추출

### 2. 페이지 블록 조회 (`read_notion_page`)

- 페이지의 모든 블록 정보 조회
- 블록 타입별 내용 파싱
- 인덱스 정보 포함

### 3. 블록 추가 (`append_block_to_page`)

- 다양한 블록 타입 지원:
  - `paragraph`: 일반 텍스트
  - `heading_1`, `heading_2`, `heading_3`: 제목
  - `to_do`: 체크리스트
  - `quote`: 인용구
  - `code`: 코드 블록

### 4. 페이지 생성 (`create_notion_page`)

- 새 페이지 생성
- 부모 페이지 하위에 생성
- 초기 내용 설정 가능

### 5. 데이터베이스 기능

- 데이터베이스 스키마 조회
- 데이터베이스 쿼리
- 데이터베이스 항목 생성

## 📊 테스트 결과 예시

```
🚀 Notion API 종합 테스트 시작
==================================================

🔍 페이지명 '테스트'로 검색 중...
   검색된 페이지 수: 3
   1. 테스트 페이지 (ID: 12345678-1234-1234-1234-123456789abc)
   2. 개발 테스트 (ID: 87654321-4321-4321-4321-cba987654321)
   3. API 테스트 (ID: 11111111-2222-3333-4444-555555555555)

📖 페이지 블록 조회 중... (ID: 12345678-1234-1234-1234-123456789abc)
   페이지 제목: 테스트 페이지
   블록 수: 5
   URL: https://notion.so/...
   - [0] paragraph: 안녕하세요! 이것은 테스트 페이지입니다...
   - [1] heading_2: 주요 내용
   - [2] bulleted_list_item: 첫 번째 항목
   - [3] bulleted_list_item: 두 번째 항목
   - [4] paragraph: 마지막 문단입니다...

➕ 블록 추가 중... (타입: paragraph)
   내용: 🤖 AI 에이전트가 추가한 테스트 블록입니다. (시간: 2025-01-27 15:30:45)
   블록 ID: 99999999-8888-7777-6666-555555555555
✅ 블록 추가: 블록 추가 성공

==================================================
📊 테스트 결과 요약
==================================================
총 테스트: 6
성공: 6 ✅
실패: 0 ❌
성공률: 100.0%
```

## 🔧 문제 해결

### SSL 인증서 오류

```python
# notion_client.py에서 SSL 검증이 비활성화되어 있습니다
# 필요시 verify=True로 변경 가능
```

### API 키 오류

```
❌ NOTION_API_KEY가 설정되지 않았습니다. .env 파일을 확인하세요.
```

→ `.env` 파일에 올바른 API 키가 설정되어 있는지 확인

### 권한 오류

```
❌ 페이지 읽기 중 오류가 발생했습니다: Unauthorized
```

→ Notion에서 통합이 워크스페이스에 추가되었는지 확인

### 페이지 ID 형식 오류

```
❌ 페이지 ID는 32자리 UUID 형식이어야 합니다
```

→ 페이지 URL에서 올바른 ID를 추출했는지 확인

## 📝 사용 팁

1. **페이지 ID 찾기**: Notion 페이지 URL에서 마지막 부분이 페이지 ID입니다

   ```
   https://notion.so/workspace/Page-Title-1234567890abcdef
   → 페이지 ID: 1234567890abcdef
   ```

2. **데이터베이스 ID 찾기**: 데이터베이스 URL에서도 동일하게 추출 가능

3. **블록 타입 확인**: `read_notion_page`로 기존 블록 타입을 확인한 후 적절한 타입으로 추가

4. **테스트 데이터**: 실제 중요한 페이지보다는 테스트용 페이지에서 먼저 시도

## 🎯 다음 단계

테스트가 성공적으로 완료되면:

1. AI 에이전트에서 Notion 도구로 활용
2. 자동화된 문서 생성 시스템 구축
3. 데이터 분석 결과를 Notion에 자동 저장
4. 팀 협업 워크플로우에 통합
